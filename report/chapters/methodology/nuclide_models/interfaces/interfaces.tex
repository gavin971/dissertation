The mass transfer interfaces between the mass balance models are essential to 
the understanding of the \Cyder paradigm.  

In groundwater transport, contaminants are transported by dispersion and 
advection. It is customary to define the combination of molecular diffusion and 
mechanical mixing as the dispersion tensor, $D$, such that, for a conservative 
solute (infinitely soluble and non-sorbing), the mass conservation equation 
becomes \cite{schwartz_fundamentals_2004, wang_introduction_1982, 
van_genuchten_analytical_1982}:

     \begin{align}
      J &= J_{dis} + J_{adv}\nonumber
      \intertext{where}
      J_{dis} &= \mbox{ Total Dispersive Mass Flux }[kg/m^2/s]\nonumber\\
      &= -\theta(D_{mdis} + \tau D_m)\nabla C \nonumber\\ 
      &= -\theta D\nabla C \nonumber\\
      J_{adv} &= \mbox{ Advective Mass Flux }[kg/m^2/s]\nonumber\\
      &= \theta vC\nonumber\\
      \tau &= \mbox{ Tortuosity }[-] \nonumber\\
      \theta &= \mbox{ Porosity }[-] \nonumber\\
      D_m &= \mbox{ Molecular diffusion coefficient }[m^2/s]\nonumber\\
      D_{mdis} &= \mbox{ Coefficient of mechanical dispersivity}[m^2/s]\nonumber\\
      D &= \mbox{ Effective Dispersion Coefficient }[m^2/s]\nonumber\\
      C &= \mbox{ Concentration }[kg/m^3]\nonumber\\
      v &= \mbox{ Fluid Velocity in the medium }[m/s].\nonumber
    \end{align}

For uniform flow in $\hat{k}$, 
    \begin{align}
      J &=\left(-\theta D_{xx} \frac{\partial C}{\partial x}
             \right)\hat{\imath}
             + \left( -\theta D_{yy} \frac{\partial C}{\partial y}
            \right)\hat{\jmath}
            + \left( -\theta D_{zz} \frac{\partial C}{\partial z}
             + \theta v_zC 
            \right)\hat{k}.
      \label{unidirflow}
    \end{align}

Solutions to this equation can be categorized by their boundary conditions.  
Those boundary conditions serve as the interfaces between components in the 
\Cyder library of nuclide transport models by way of advective, dispersive, 
coupled, and fixed fluxes.  This is supported by implementation in which 
vertical advective velocity is uniform throughout the system and in which 
parameters such as the dispersion coefficient are known for each component. 

\subsection{Dirichlet Boundary Condition}

The first, specified-concentration or Dirichlet type boundary conditions define 
a specified species concentration on some section of the boundary of the 
representative volume, 

    \begin{align}
      C(\vec{r},t)\Big|_{\vec{r} \in \Gamma} &= C_0(t)
      \intertext{where}
      \vec{r} &= \mbox{ position vector }\nonumber\\
      \Gamma &= \mbox{ domain boundary }.\nonumber
    \end{align}

The Dirichlet boundary condition can be provided by any mass balance model, 
based on the concentration profile calculated in the previous section,

\begin{align}
C(z,t_n)|_{z=r_j} &= \mbox{ fixed concentration in j at }r_j\mbox{ and }t_n [kg/m^3].\nonumber\\ 
                  &= \begin{cases} 
                         \frac{m_{d}(t_n)}{V_{d}(t_n)}, & \mbox{Degradation Rate}\\
                         \frac{m_{df}(t_n)}{V_{df}(t_n)}, & \mbox{Mixed Cell}\\
                         C_{out}(t_n), & \mbox{Lumped Parameter}\\
                         C(r_j,t_n), & \mbox{One Dimensional PPM}.
                      \end{cases}
\end{align}

On its inner boundary, the Lumped Parameter model uses this fixed concentration 
boundary condition directly in its solution such that, 
\begin{align}
C_{in,j}(t_n) &= C(z, t_n)|_{z=r_i}.
\end{align}

The resulting mass transfer into the external component containing the Lumped 
Parameter model is 

\begin{align}
m_{ij}(t_n) &=\int C(z,t_n)dV - \int C(z, t_{n-1})dV.
\end{align}

In the Degradation Rate and Mixed Cell models, the Dirichlet boundary condition can 
be chosen to enforce an advective flux on the inner boundary. This choice is 
appropriate when the user expects a primarily advective interface between two 
components. The advective flux across the boundary between two components $i$ 
and $j$, 

\begin{align}
J_{adv,ij}(t_n) &= \mbox{ potential advective flux from i to j at }t_n[kg/m^2/s]\nonumber\\
               &= \theta_j v C(z,t_n)|_{z=r_i}
\end{align}
relies on the fixed concentration Dirichlet boundary condition at the 
interface, provided by the internal component.

The resulting mass transfer into the Degradation Rate or Mixed Cell model
is, therefore, 
\begin{align}
m_{ij}(t_n) &= A\Delta t \theta_j v C(z,t_n)|_{z=r_i}
\intertext{where}
A &= \mbox{ surface area normal to the flow direction }[m^2]\nonumber\\
\Delta t &= \mbox{ length of the time step }[s].\nonumber
\end{align}

\subsection{Neumann Boundary Condition}

The second type, specified-flow or Neumann type boundary conditions describe a full set of 
concentration gradients at the boundary of the domain,
    \begin{align}
      \frac{\partial C(\vec{r},t)}{\partial r}\Big|_{\vec{r}\in\Gamma} &= f(t)\\
      f(t) &= \mbox{ known function }.\nonumber
    \end{align}

The Neumann boundary condition can be provided at the external boundary of any 
mass balance model,
\begin{align}
\frac{\partial C}{\partial z}\Bigg|_{z=r_j} &= \mbox{ fixed concentration gradient in j at }r_j\mbox{ and } t_n [kg/m^3/s].\nonumber
\end{align}


For mass balance models that are 0d in space (i.e. the Degradation Rate model 
and the Mixed Cell model), the center-to-center difference between adjacent 
components is taken,

\begin{align}
\frac{\partial C(z,t_n)}{\partial z}\Bigg|_{z=r_j} &= \frac{C_k(r_{k-1/2},t_{n-1}) - C_j(r_{j-1/2}, t_n)}{r_{k-1/2} - r_{j-1/2}}
\intertext{where}
r_{j-1/2} &= r_{j} - \frac{r_{j} - r_i}{2}\nonumber\\
r_{k-1/2} &= r_{k} - \frac{r_{k} - r_j}{2}.\nonumber
\end{align}

However, for mass balance models that are 1d in space (i.e. the Lumped Parameter model 
and the One Dimensional PPM model), the derivative is taken based on the 
concentration profile in the internal component as it approaches the boundary. 
For the lumped parameter model, where the profile is assumed to be a linear 
relationship between $C_{in}$ and $C_{out}$, the gradient is

\begin{align} 
\frac{\partial C(z,t_n)}{\partial z}\Bigg|_{z=r_j} &= \frac{C_{out} - C_{in}}{r_{j} - r_{i}}.
\end{align}

For the one dimensional permeable porous medium model, the analytical 
derivative of equation \eqref{simple_genuchten} is evaluated at $r_j$.

%\begin{align}
%derivative..
%\end{align}

In the Degradation Rate and Mixed Cell models, the Neumann boundary condition 
can be chosen to enforce a dispersive flux on the inner boundary. This choice 
is appropriate when the user expects a primarily dispersive flow across the 
boundary.
The dispersive flux in one dimension, 
\begin{align}
      J_{dis} &= \mbox{ Total Dispersive Mass Flux }[kg/m^2/s]\nonumber\\
      &= -\theta D\frac{\partial C}{\partial z}\Big|_{z=r_j} \nonumber
\end{align}
relies on the fixed gradient Neumann boundary condition at the interface, 
provided by the internal component. 

The resulting mass transfer into the Degradation Rate or Mixed Cell model is, 
therefore, 

\begin{align}
m_{ij}(t_n) &= - A\Delta t D \frac{\partial C(z,t_n)}{\partial z}|_{z=r_i}.
\end{align}


\subsection{Cauchy Boundary Condition}

The third, head-dependent mixed boundary condition or Cauchy type, defines a 
solute flux along a boundary.  The fixed concentration flux Cauchy boundary 
condition can be provided at the external boundary of any mass balance model.  
For a vertically oriented system with advective velocity in the $\hat{k}$ 
direction,

    \begin{align}
      -D\frac{\partial C(z, t)}{\partial z}\Big|_{z \in \Gamma} + v_zC(z, t) &= v_zC(t) 
      \intertext{where}
      C(t) &= \mbox{ a known concentration function }[kg/m^{3}].\nonumber
    \end{align}  

On its inner boundary, the One Dimensional PPM model uses this fixed flux 
boundary condition directly in its solution such that, 
\begin{align}
C_{0,j}(t_n) &=  
\end{align}

The resulting mass transfer into the external component containing the Lumped 
Parameter model is 

\begin{align}
m_{ij}(t_n) &=\int C(z,t_n)dV - \int C(z, t_{n-1})dV.
\end{align}

In the Degradation Rate and Mixed Cell models, the Cauchy boundary condition 
can be selected to enforce coupled advective and dispersive flow.  The 
resulting mass transfer into the Degradation Rate or Mixed Cell model is then, 

\begin{align}
m_{ij}(t_n) &= A\Delta t \left( \theta_j v C(z,t_n)|_{z=r_i} - D \frac{\partial C(z,t_n)}{\partial z}|_{z=r_i} \right).
\end{align}



\subsection{Maximum Flow}
For debugging and testing purposes, the maximum flow mode transports all 
available material in a component into the component external to it. 

The total available mass for each mass balance model can be expressed,
\begin{align}
m_{ij}(t_n) &= \begin{cases}
                         m_{d}(t_n), & \mbox{Degradation Rate}\\
                         m_{df}(t_n), & \mbox{Mixed Cell}\\
                         \int C(z,t_n)dV, & \mbox{Lumped Parameter}\\
                         \int C(z,t_n)dV, & \mbox{One Dimensional PPM}.
               \end{cases}
\end{align}

The integrals for the Lumped Parameter model and the One Dimensional PPM model 
are calculated numerically.

\subsection{Implicit Timestepping}

This section has been deprecated and will be re-envisioned soon.

%
%\subsection{Flow Mode Selection}
%
%  \begin{figure}[htp!]
%    \begin{center}
%      \def\svgwidth{\textwidth}
%      \input{./chapters/methodology/nuclide_models/interfaces/flow.eps_tex}
%    \end{center}
%    \caption[\Cyder Component interfaces provide a source term  and three 
%    boundary condition types.]{The boundaries between components (e.g., waste form and waste 
%      package) are robust interfaces defined by boundary condition types.}
%    \label{fig:flow}
%  \end{figure}
%
%
%
%The spatial concentration throughout the volume is sufficient to fully describe 
%implementation of advective, dispersive, and couple mass flow modes within 
%\Cyder. 
%
%\begin{align}
%\mathcal{C}_j(t_n) &= \mbox{ fixed concentration flux from component j at }t_n [kg/m^2/s]\nonumber\\
%                   &= -D\frac{\partial C(t_n)}{\partial r}\Bigg|_{r=r_j} + v_zC(t_n)\Bigg|_{r=r_j} \\
%\label{deg_rate_cauchy}
%\end{align}
%
%%<++> &= \mbox{ <++> }[<++>] \nonumber\\
%% mixed
%\subsection{Mixed Cell Calculation of Mass Transfer}
%
%The MixedCell model can operate in four modes, each dictating the method by 
%which mass transfer across the inner boundary is calculated.  Those modes 
%utilize the source term, Dirichlet, and Neumann interfaces to model prescribed, 
%flow, advective flow, or diffusive flow.
%Once calculated, that material object is removed from the 
%internal component ($m_{ij} = -\dot{m}_i$) such that its internal state can be 
%queried accurately in future time steps.  
%
%For the case in which source term is used on the inner boundary, the mass 
%transferred from component $i$ to component $j$ in time step $t_{n}$ is simply
%
%\begin{align} 
%m_{ij} &=  \mathcal{S}_i(t_n) \nonumber
%\intertext{where}
%\mathcal{S}_i(t_n) &= \mbox{ source term provided by component i at }t_n [kg].
%\end{align}
%
%For the case in which Dirichlet is used, the mass transferred is determined by 
%advection. One dimensional mass flux due to advection is the speed of flowing 
%water, $v_z$, scaled by the concentration of contaminants fixed by the Dirichlet 
%boundary condition, $C$, all integrated over the porous, degraded area perpendicular to 
%the flow, $\theta dxdy$,
%
%\begin{align}
%  m_{ij} &= \int_{t_{n-1}}^{t_n}\int_0^y\int_0^x\theta d v_z \mathcal{D}_i(t_n) dxdydt \label{mixed_adv}
%\intertext{which, for the Cyder components, becomes }
%m_{ij} &= \theta d v_z C 2rl (t_n - t_{n-1})\nonumber\\
%\intertext{where}
%\mathcal{D}_i(t_n) &= \mbox{ fixed C from component i at }t_n [kg/m^3]\nonumber\\
%r &= \mbox{ radius of the cylinder }[m]\nonumber\\
%l &= \mbox{ length of the cylinder }[m].\nonumber
%\end{align}
%
%For the case in which Neumann is chosen, the mass transfer is taken to be 
%dispersive, 
%
%\begin{align}
%  m_{ij} &= \int_{t_{n-1}}^{t_n}\int_0^y\int_0^x -D \theta d \mathcal{N}_i(t_n) dxdydt \label{mixed_adv}\\
%         &= \int_{t_{n-1}}^{t_n}\int_0^y\int_0^x -D \theta d \frac{\partial C}{\partial z}\Bigg|_{z=r_j} dxdydt \nonumber
%\intertext{which, for the Cyder components, becomes }
%m_{ij} &= -D \theta d \frac{\partial C}{\partial z}\Bigg|_{z=r_j} 2rl(t_n - t_{n-1}).\nonumber
%\end{align}
%
%\subsection{Mixed Cell Boundary Interfaces}
%The source term of available contaminants is all mass in the available degraded fluid,
%\begin{align}
%\mathcal{S}_j(t_n) &= m_{df}(t_n). 
%\end{align}
%The desired boundary conditions can be expressed in terms of $m_{df}$. First, the 
%Dirichlet boundary condition is 
%\begin{align}
%\mathcal{D}_j(t_n) &= C_j(t_n)\nonumber\\ 
% &= \frac{m_{df}(t_n)}{V_{df}(t_n)}.
%\label{dirichlet_mixed}
%\end{align}
%
%From this boundary condition in combination with global advective velocity 
%data, porosity data,  and elemental dispersion coefficient data, all other 
%boundary conditions can be found. The Neumann boundary condition generated at 
%the external boundary of cell $j$ relies on up to date data from cell $k$ and 
%on internal state data from the previous time step, such that 
%
%\begin{align}
%\mathcal{N}_j(t_n)&= \frac{dC(t_n)}{dr}\Bigg|_{r=r_j}\nonumber\\ 
%                  &= \frac{C_k(r_{k-1/2},t_{n-1}) - C_i(r_{j-1/2}, t_n)}{r_{k-1/2} - r_{j-1/2}}
%\label{neumann_mixed}
%\intertext{where}
%r_{j-1/2} &= r_{j} - \frac{r_{j} - r_{i}}{2}.\nonumber\\
%r_{k-1/2} &= r_{k} - \frac{r_{k} - r_{j}}{2}.\nonumber
%\end{align}
%
%This expression for the concentration gradient can also be used in the Cauchy 
%boundary condition, which relies on the advective velocity and concentration 
%profile as well as the concentration gradient,
%
%\begin{align}
%v_z C_0 &= \frac{dC(t_n)}{dr}\Big|_{r=r_{j}} + v_{z}C_j(t_n).
%\label{cauchy_mixed}
%\end{align}
%
%
%% lumped
%\subsection{Lumped Parameter Calculation of Mass Transfer}
%
%The Lumped Parameter model requires a specified internal concentration, so the 
%Dirichlet boundary condition is queried at the internal boundary of the lumped 
%parameter nuclide model. To calculate the resulting mass transfer over a 
%time step, the response function is applied and a linear concentration profile 
%is made across the cell. The concentration profile combined with 
%information about the initial state and the water volume in the cell, can be 
%integrated over the volume to arrive at a resulting mass in the cell,
%
%\begin{align}
%m_j(t_n) &= \int_0^V \theta C(t_n, r) dV \\\label{lp_mass}
%         &= \int_{r_i}^{r_j} \int_0^{2\pi} \int_0^h \theta C(t_n, r) r dr d\phi dh\nonumber \\
%         &= 2\pi l\theta \int_{r_i}^{r_j} C(t_n, r)rdr \nonumber\\
%         &= 2\pi l\theta \int_{r_i}^{r_j}\left( \frac{C_j(t_n) - C_i(t_n)}{r_j - r_i}r^2 + C_j(t_n)r \right) dr\nonumber
%\intertext{such that}
%m_j(t_n) &= 2\pi l \theta \left[ \frac{C_j(t_n) - C_i(t_n)}{3\left(r_j - r_i\right)}r^3 + C_j(t_n-1) \frac{r^2}{2}\right]_{r_i}^{r_j} \nonumber\\
%         &= 2\pi l \theta \left[ \frac{C_j(t_n) - C_i(t_n)}{3\left(r_j - r_i\right)}(r_j-r_i)^3 + C_j(t_n) \frac{(r_j-r_i)^2}{2}\right]\nonumber\\ 
%         &= 2\pi l \theta (r_j-r_i)^2 \left[ \frac{C_j(t_n) - C_i(t_n)}{3} + \frac{C_j(t_n)}{2} \right]\nonumber\\ 
%         &= 2\pi l \theta (r_j-r_i)^2 \left[ \frac{5C_j(t_n)}{6} - \frac{C_i(t_n)}{3} \right]. 
%\end{align}
%
%Using this expression for $m_j$, the necessary mass transfer from $m_i$ is 
%simply
%
%\begin{align}
%m_{ij} &= m_j(t_n) - m_j(t_{n-1}).
%\end{align}
%
%\subsection{Lumped Parameter Boundary Interfaces}
%The external source term and boundary conditions are found exactly similarly to the method by 
%which the Degradation Rate model finds external boundary conditions in Section 
%\ref{sec:dr_bc}. This method is entirely based on contained mass and component 
%volume.  
